<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark PDF Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            background: #111;
            color: #eee;
            font-family: Verdana, sans-serif;
            padding: 20px;
            margin: 0;
        }
        h1 { margin-top: 0; }
        .panel {
            background: #1b1b1b;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        label { display: block; margin: 10px 0 4px 0; font-size: 14px; }
        input[type="number"], input[type="text"], input[type="file"] {
            width: 100%; max-width: 320px;
            padding: 8px; border-radius: 4px;
            border: 1px solid #444; background: #111;
            color: #eee; font-family: Verdana, sans-serif;
        }
        .btn {
            padding: 12px 24px; border-radius: 6px; border: none;
            cursor: pointer; font-weight: bold; font-size: 14px;
            background: #3d8db7; color: white; font-family: Verdana;
        }
        .btn:hover:not(:disabled) { background: #2a6a8e; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        #preview {
            background: #000; color: #fff; padding: 20px;
            border-radius: 8px; min-height: 200px; max-height: 400px;
            overflow-y: auto; white-space: pre-wrap; font-size: 14px;
        }
        #status { margin-top: 10px; font-size: 13px; color: #aaa; }
        #fileInfo { font-size: 13px; margin-top: 8px; color: #ccc; }
    </style>
</head>
<body>
    <h1>ğŸŒ™ Dark PDF Converter</h1>
    <p>Carica â†’ Regola â†’ Esporta PDF nero</p>

    <div class="panel">
        <label for="fileInput">ğŸ“„ File (TXT, PDF, DOCX):</label>
        <input type="file" id="fileInput" accept=".txt,.pdf,.docx">
        <p id="fileInfo"></p>
    </div>

    <div class="panel">
        <label for="fontSize">ğŸ“ Dimensione font:</label>
        <input type="number" id="fontSize" value="16" min="12" max="24">
        <label for="lineHeight">ğŸ“ Interlinea:</label>
        <input type="number" id="lineHeight" value="1.8" step="0.1" min="1" max="3">
    </div>

    <div class="panel">
        <h3>ğŸ‘ï¸ Anteprima (esatta)</h3>
        <div id="preview">Carica un file per vedere...</div>
    </div>

    <div class="panel">
        <button class="btn" id="exportPdf" disabled>ğŸ’¾ Esporta PDF Dark</button>
        <p id="status"></p>
    </div>

<script>
let uploadedText = '';

document.getElementById('fileInput').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;

    document.getElementById('status').textContent = 'ğŸ”„ Lettura...';
    
    try {
        uploadedText = await file.text();
        document.getElementById('preview').style.fontSize = document.getElementById('fontSize').value + 'px';
        document.getElementById('preview').style.lineHeight = document.getElementById('lineHeight').value;
        document.getElementById('preview').textContent = uploadedText;
        document.getElementById('fileInfo').textContent = `âœ… ${file.name}`;
        document.getElementById('exportPdf').disabled = false;
        document.getElementById('status').textContent = 'âœ… Pronto!';
    } catch {
        alert('âŒ Errore file');
    }
});

document.getElementById('fontSize').addEventListener('input', updatePreview);
document.getElementById('lineHeight').addEventListener('input', updatePreview);

function updatePreview() {
    if (uploadedText) {
        document.getElementById('preview').style.fontSize = document.getElementById('fontSize').value + 'px';
        document.getElementById('preview').style.lineHeight = document.getElementById('lineHeight').value;
    }
}

document.getElementById('exportPdf').addEventListener('click', () => {
    if (!uploadedText) return;
    
    document.getElementById('status').textContent = 'ğŸ–¨ï¸ PDF...';
    
    const printDiv = document.createElement('div');
    printDiv.innerHTML = `<div style="
        font-family: Verdana, sans-serif !important;
        font-size: ${document.getElementById('fontSize').value}px !important;
        line-height: ${document.getElementById('lineHeight').value} !important;
        background: #000 !important;
        color: #fff !important;
        padding: 3cm 2cm !important;
        width: 21cm !important;
        margin: 0 !important;
        white-space: pre-wrap !important;
        word-wrap: break-word !important;
    ">${uploadedText.replace(/\n/g, '<br>')}</div>`;
    
    document.body.appendChild(printDiv);
    
    html2pdf().set({
        filename: 'PDF-Dark.pdf',
        margin: 0,
        image: { type: 'jpeg', quality: 0.95 },
        html2canvas: { 
            scale: 2, 
            useCORS: true,
            backgroundColor: '#000000'
        },
        jsPDF: { 
            unit: 'cm', 
            format: 'a4', 
            orientation: 'portrait' 
        }
    }).from(printDiv).save().then(() => {
        document.body.removeChild(printDiv);
        document.getElementById('status').textContent = 'âœ… PDF scaricato!';
    });
});
</script>
</body>
</html>
