<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>TXT â†’ PDF Nero</title>

<!-- PDFMake -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<style>
body { background:#111; color:white; padding:40px; font-family:Arial; }
button { margin-top:20px; padding:10px 18px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<h2>Converti TXT in PDF Nero (testo bianco, Verdana)</h2>

<input type="file" id="fileInput" accept=".txt">
<button id="btnPdf" disabled>Esporta PDF</button>
<p id="status"></p>

<script>
let uploadedText = "";
const btnPdf = document.getElementById("btnPdf");
const status = document.getElementById("status");

function setStatus(msg){ status.textContent = msg; }

// Carica font Verdana
async function loadFonts() {
    const v = await fetch("verdana.ttf").then(r=>r.arrayBuffer());
    const vb = await fetch("verdanab.ttf").then(r=>r.arrayBuffer());

    pdfMake.vfs["verdana.ttf"] = btoa(String.fromCharCode(...new Uint8Array(v)));
    pdfMake.vfs["verdanab.ttf"] = btoa(String.fromCharCode(...new Uint8Array(vb)));

    pdfMake.fonts = {
        verdana: {
            normal: "verdana.ttf",
            bold: "verdanab.ttf",
            italics: "verdana.ttf",
            bolditalics: "verdanab.ttf"
        }
    };
}
loadFonts().then(()=>setStatus("Font Verdana pronti. Seleziona un file TXT"));

// Carica TXT
document.getElementById("fileInput").addEventListener("change", async e=>{
    const file = e.target.files[0];
    if(!file) return;
    setStatus("Caricamento file...");
    uploadedText = await file.text();
    setStatus("Caricamento avvenuto con successo.");
    btnPdf.disabled = false;
});

// Genera PDF
btnPdf.addEventListener("click", ()=>{
    if(!uploadedText){ setStatus("Nessun testo caricato"); return; }

    setStatus("Generazione PDF...");

    const lines = uploadedText.split("\n");

    const docDefinition = {
        pageMargins:[40,40,40,40],
        background: [{canvas:[{type:'rect', x:0, y:0, w:595, h:842, color:'black'}]}],
        content: lines.map(line=>({
            text: line || " ",
            font:"verdana",
            fontSize:16,
            color:"white",
            lineHeight:1.5
        }))
    };

    pdfMake.createPdf(docDefinition).getBlob(function(blob){
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "testo_nero.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        setStatus("PDF esportato con successo");
    });
});
</script>

</body>
</html>
